---
# =============================================================================
# 메인 페이지 (Books Gallery)
# =============================================================================
# 이 페이지는 _books 폴더의 마크다운 파일들을 읽어와
# CSS Grid 갤러리 형태로 책 목록을 표시합니다.
# =============================================================================
layout: default
title: Books
---

<!-- 정렬 및 필터 네비게이션 -->
<div class="nav-container">
    <!-- 기본 네비게이션 (정렬 + 임프린트 필터) -->
    <div id="main-nav" class="sort-nav">
        <button class="sort-btn active" data-sort="newest">Newest</button>
        <button class="sort-btn" data-sort="alpha">A-Z</button>
        <button class="sort-btn filter-trigger" data-imprint="이김">이김</button>
        <button class="sort-btn filter-trigger" data-imprint="냉수">냉수</button>
    </div>

    <!-- 필터 모드 네비게이션 -->
    <div id="filter-nav" class="sort-nav" style="display: none;">
        <button class="sort-btn active" id="active-filter-name"></button>
        <button class="sort-btn" id="all-btn">All</button>
    </div>
</div>

<!-- 책 갤러리 -->
<section class="books-gallery" id="books-gallery">
    {% assign sorted_books = site.books | sort: 'date' | reverse %}
    {% for book in sorted_books %}
    {% comment %} TSV 데이터에서 임프린트 정보 가져오기 {% endcomment %}
    {% assign book_data = nil %}
    {% for item in site.data.books_import_data %}
    {% if item.ISBN == book.isbn %}
    {% assign book_data = item %}
    {% break %}
    {% endif %}
    {% endfor %}
    {% assign imprint = book_data["임프린트"] | strip %}

    <a href="{{ book.url | relative_url }}" class="book-card-link" data-title="{{ book.title }}"
        data-date="{{ book.date | date: '%s' }}" data-imprint="{{ imprint }}">
        <article class="book-card">
            <!-- 책 표지 -->
            <div class="book-cover">
                {% if book.cover_image %}
                <img src="{{ book.cover_image | relative_url }}" alt="{{ book.title }} 표지">
                {% else %}
                <!-- 이미지가 없을 때 플레이스홀더 -->
                <div class="book-cover-placeholder">
                    <span>표지 이미지<br>준비중</span>
                </div>
                {% endif %}
            </div>

            <!-- 책 정보 -->
            <div class="book-info">
                <h2 class="book-title">{{ book.title }}</h2>
                <p class="book-author">{{ book.author }}</p>
                <p class="book-year">{{ book.year }}</p>
            </div>
        </article>
    </a>
    {% endfor %}
</section>

<style>
    .nav-container {
        margin-bottom: 20px;
    }
</style>

<!-- 정렬 및 필터 스크립트 -->
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const gallery = document.getElementById('books-gallery');
        const mainNav = document.getElementById('main-nav');
        const filterNav = document.getElementById('filter-nav');
        const activeFilterName = document.getElementById('active-filter-name');

        const sortButtons = mainNav.querySelectorAll('.sort-btn[data-sort]');
        const filterTriggers = document.querySelectorAll('.filter-trigger');
        const allButton = document.getElementById('all-btn');
        const items = Array.from(document.querySelectorAll('.book-card-link'));

        // 정렬 함수
        function sortItems(type) {
            const sortedItems = items.sort((a, b) => {
                if (type === 'newest') {
                    const dateA = parseInt(a.getAttribute('data-date')) || 0;
                    const dateB = parseInt(b.getAttribute('data-date')) || 0;
                    return dateB - dateA;
                } else if (type === 'alpha') {
                    const titleA = a.getAttribute('data-title').toLowerCase();
                    const titleB = b.getAttribute('data-title').toLowerCase();
                    return titleA.localeCompare(titleB);
                }
            });
            return sortedItems;
        }

        // 갤러리 업데이트 함수
        function updateGallery(filteredItems) {
            gallery.innerHTML = '';
            filteredItems.forEach(item => {
                gallery.appendChild(item);
            });
        }

        // 정렬 버튼 이벤트
        sortButtons.forEach(button => {
            button.addEventListener('click', () => {
                const sortType = button.getAttribute('data-sort');
                sortButtons.forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');

                const sorted = sortItems(sortType);
                updateGallery(sorted);
            });
        });

        // 임프린트 필터 버튼 이벤트
        filterTriggers.forEach(button => {
            button.addEventListener('click', () => {
                const imprint = button.getAttribute('data-imprint');

                // UI 전환
                mainNav.style.display = 'none';
                filterNav.style.display = 'flex';
                activeFilterName.textContent = imprint;

                // 필터링 적용
                items.forEach(item => {
                    if (item.getAttribute('data-imprint') === imprint) {
                        item.style.display = 'block';
                    } else {
                        item.style.display = 'none';
                    }
                });
            });
        });

        // All 버튼 이벤트 (필터 해제)
        allButton.addEventListener('click', () => {
            // UI 복구
            filterNav.style.display = 'none';
            mainNav.style.display = 'flex';

            // 모든 아이템 표시 및 현재 정렬 유지
            const activeSortBtn = mainNav.querySelector('.sort-btn.active');
            const activeSort = activeSortBtn ? activeSortBtn.getAttribute('data-sort') : 'newest';

            items.forEach(item => {
                item.style.display = 'block';
            });

            const sorted = sortItems(activeSort);
            updateGallery(sorted);
        });
    });
</script>