require 'csv'

input_file = '_data/books_import_data.tsv'

# Robust reading similar to clean_tsv.rb
raw_content = File.read(input_file, encoding: 'utf-8')
lines = raw_content.split("\n").map(&:strip).reject(&:empty?)
clean_raw = lines.join("\n")

table = CSV.parse(clean_raw, col_sep: "\t", headers: true)
header = table.headers

# Data for "닌텐도 다이어리"
isbn = '979-11-89680-49-7'

book_intro = <<~TEXT
『닌텐도 다이어리』는 게임을 통해 부모와 아이가 함께 성장하고 소통하는 여정을 담은 에세이다. 인터넷, 유튜브, 모바일 게임처럼, 제어할 수 없는 매체에 아이가 노출될 수밖에 없는 시대. 디지털 홍수를 피해 도달한 세계는 다름아닌 게임이었다. 잘 만들어진 게임을 딸과 함께 플레이하며 대화가 시작되고, 서로의 세계를 이해하며, 때로는 다투고 화해하면서 깊은 유대감을 형성하는 과정을 세심하게 기록했다. 『닌텐도 다이어리』는 모든 가족에게 게임이 단순한 오락을 넘어 유익한 도구가 될 수 있음을 보여준다. 거기에 실제로 게임을 해볼 수 있도록 상세한 현실적 팁까지 꽉꽉 눌러 담았다.
TEXT

toc = <<~TEXT
프롤로그 안전한 콘텐츠를 찾아 게임기를 쥐여주다<br><br>1. 슈퍼마리오 오디세이<br>2. 동물의 숲<br>3. 루이지 맨션 3<br>4. 별의 커비<br>5. 마인크래프트<br>6. 젤다의 전설: 브레스 오브 더 와일드<br>7. 페이퍼 마리오 종이접기 킹<br>8. 바람의 나라<br>9. 괴혼 ~굴려라 돌아온 왕자님~<br>10. 링피트 어드벤처<br>11. 토카월드 & 로블록스<br>12. 젤다의 전설: 티어스 오브 더 킹덤<br>13. 엉덩이 탐정 뿡뿡! 내가 바로 미래의 명탐정!<br><br>에필로그 게임, 우리 가족의 버튼
TEXT

excerpt = <<~TEXT
어린이용 유튜브를 틀어주었는데, 옆에서 같이 보다 보니 ‘이걸 정말 아이에게 보여줘도 되는 걸까?’ 싶은 콘텐츠가 많았다. 이를 일일이 검열하느니 차라리 어린이용 모바일 게임이 낫겠다는 판단이 들었다. 그러나 모바일 게임도 완벽한 청정구역은 아니었다. (…) 자극적이고 폭력적인 광고라는 큰 단점이 있었기 때문이다. -14쪽<br><br>〈슈퍼마리오 오디세이〉는 마리오 시리즈가 여태 유지했던 ‘공주 구출’의 서사를 ‘결혼’ 콘셉트로 구체화하지만, 도리어 결혼과는 정면으로 대결한다. 이 안에서 여성 캐릭터들은 자신의 욕망과 의지를 분명하게 밝히고, 자신의 정체성을 실현하는 방향으로 확실하게 자리매김한다. - 31쪽<br><br>지금은 아니더라도 아이는 언젠가 누군가를 영영 잃어버리는 일을 겪을 것이다. 아이가 죽음을 마주하고 슬픔에 빠지는 순간이 오면 이 게임 〈페이퍼 마리오 종이접기 킹〉을 함께 플레이하고 또 엉엉 울었던 일을 떠올릴 수 있다면 좋겠다는 생각이 들었다. - 122쪽<br><br>매월 1일에 한 번 만 원을 받으면 규칙적인 생활을 할 수 있어. 특히 돈을 언제 받아서 어떻게 쓸 수 있는지 제대로 알 수 있거든. (어린이 플레이어의 말) - 175쪽
TEXT

publisher_review = <<~TEXT
조이패드를 손에 쥔 순간, 엄마와 딸의 새로운 세계가 열렸다!<br><br>조경숙 작가의 『닌텐도 다이어리』가 새로 출간되었다. 이 책에는 게임을 통해 부모와 아이가 함께 성장하고 소통하는 여정을 담은 열두 편의 에세이와 함께 실제로 게임을 하는 데 도움이 될 팁, 그리고 어린이 플레이어의 한마디로 이루어져 있다.<br><br>“어린이용 유튜브를 틀어주었는데, 옆에서 같이 보다 보니 ‘이걸 정말 아이에게 보여줘도 되는 걸까?’ 싶은 콘텐츠가 많았다. 이를 일일이 검열하느니 차라리 어린이용 모바일 게임이 낫겠다는 판단이 들었다. 그러나 모바일 게임도 완벽한 청정구역은 아니었다. (…) 자극적이고 폭력적인 광고라는 큰 단점이 있었기 때문이다.” - 본문 중에서<br><br>2023년 그 공로를 인정받아 올해의 양성평등문화상 신진여성문화인상을 수상한 조경숙 작가는 평소 만화 평론가 겸 개발자로 왕성한 활동을 이어나가고 있는 멀티 플레이어다. 집에서는 한 아이의 엄마다. 이 시대에 아이들을 디지털 매체에서 멀어지게 할 방법은 사실상 없다. 식당에서 아이를 조용히 시키고 좀 편안히 밥 한술 뜨려면 찜찜하더라도 스마트폰을 쥐여 주어야 하는 딜레마를 많은 부모가 느꼈을 것이다. 그러다 보면 유튜브나 모바일 게임, 그리고 그 속에 갑자기 튀어나오는 광고같이, 제어할 수 없는 매체에 아이들이 노출된다. 저자가 이 책에서 디지털 홍수를 피해 도달한 세계는 다름 아닌 게임이었다. 그중에서도 자신도 좋아하는 닌텐도 스위치라는 콘솔이 가장 적절해 보였다. 게임기를 집어든 다음부터 엄마와 딸의 새로운 세계가 시작되었다.<br><br>단순한 유희적 목적으로만 게임을 하는 것이라고 생각하지만 실제로 엄마와 딸은 게임을 통해 새로운 경험을 해나간다. 〈슈퍼마리오 오디세이〉에서는 피치공주가 보여주는 주체적 여성 캐릭터의 역할을, 〈페이퍼 마리오 종이접기 킹〉에서는 생명과 죽음을, 〈동물의 숲〉에서는 마을의 다른 존재와 함께 잘 지내는 방법을 배운다.<br><br>“엄마가 복숭아 숲 건들지 말랬지! 넌 도대체 이 게임이 뭐라고 생각해?”<br>“이 게임은 같이 하는 거잖아! 재밌는 동물 주민들이랑 함께 아무거나 해도 되는 평화로운 게임!”<br><br>『닌텐도 다이어리』에서는 게임을 하며 가족 사이에 새로이 만들어지는 관계도 볼 수 있다. 스테이지 클리어라는 공동의 목표를 향한 협력, 함께 더 좋은 방향을 찾기 위한 대화, 무엇보다 빠지면 섭섭할 엄마와 아이의 의견 충돌과 갈등, 그리고 화해와 봉합의 과정이 나온다. 작가는 이 모든 에피소드를 과장하거나 덜어내지 않고 솔직하게 그려낸다. 그렇다고 게임이 교과서나 교재의 역할을 할 수 있다는 말은 아니다. 모든 아이들이 그렇듯이 작가의 딸 소해도 모든 것을 엄마가 의도한 대로 받아들이지 않는다. 아이에게는 자신만의 세계와 시선이 있고, 그것을 인정해주는 것도 부모의 역할임을 작가는 깨닫는다.<br><br>“아이가 떠나는 모험 길에 첫 번째 동료로 간택 받는 건, 꽤 근사한 일이다. 아이가 나를 언제까지 동료로 택해줄지는 모르는 일이지만, 앞으로도 또 재밌는 모험을 함께 떠나기 위해 아이의 신뢰와 기대를 깨지 않는 동료로 남고 싶다.” -본문 중에서<br><br>매 장 마지막 부분에는 이 책을 보고 게임을 하고 싶은 독자들을 위한 현실적인 팁이 실려 있다. 닌텐도 스위치를 구입하는 방법이나, DLC나 데모 버전을 다운받는 방법 등 게임을 접하는 방법과, 광과민성 증후군, 게임의 교육적 기능, 멀티플레이에 대한 의견 등 게임의 일반적 주의사항을 제공한다. 또한 굿즈를 만들거나 게임을 소재로 여행하기 등 실생활에서 할 수 있는 게임 밖의 활동에 대한 재미난 꿀팁으로 가득하다.
TEXT

author_intro = <<~TEXT
게임에 빠져 유년기를, 만화에 묻혀 청소년기를 보낸 서브컬처 마니아. 테크-페미 활동가, 만화평론가로 활동하며 글을 쓴다. 『닌텐도 다이어리』의 글을 쓰고, 이소해의 그림 마감을 독촉하는 역할도 맡았다.<br>『액세스가 거부되었습니다』, 『인스타그램을 교란하는 인스타툰: 수신지 작가론(스포로이드 진 3호)』, 『아무튼, 후드티』를 썼고, 『웹툰 내비게이션』, 『웹툰 입문』을 함께 썼다.
TEXT

updated = false
rows = []
table.each do |row|
  if row['ISBN'] == isbn
    row['제목'] = '닌텐도 다이어리'
    row['부가기호'] = '03810'
    row['부제'] = '엄마와 딸, 게임으로 레벨 업!'
    row['저자'] = '조경숙'
    row['임프린트'] = '이김'
    row['출간일'] = '2024-01-22'
    row['정가'] = '16,800'
    row['가로'] = '120'
    row['세로'] = '190'
    row['페이지수'] = '208'
    row['책 소개'] = book_intro.strip
    row['목차'] = toc.strip
    row['출판사 서평'] = publisher_review.strip
    row['저자 소개'] = author_intro.strip
    row['본문 인용'] = excerpt.strip
    updated = true
  end
  rows << row
end

if updated
  File.open(input_file, "w", encoding: 'utf-8') do |f|
    f.puts header.to_csv(col_sep: "\t")
    rows.each do |row|
      f.puts row.to_csv(col_sep: "\t")
    end
  end
  puts "Updated data for Nintendo Diary (ISBN: #{isbn})."
else
  puts "ISBN #{isbn} not found."
end
