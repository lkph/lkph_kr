---
# =============================================================================
# 책 상세 페이지 레이아웃
# =============================================================================
# 이 레이아웃은 개별 책의 상세 정보를 표시합니다.
# _books 폴더에 있는 마크다운 파일에 적용됩니다.
# TSV 데이터에서 모든 책 정보를 가져옵니다.
# =============================================================================
layout: default
---

{% comment %}
TSV 데이터에서 현재 책의 정보를 ISBN으로 조회
{% endcomment %}
{% assign book_data = nil %}
{% for item in site.data.books_import_data %}
{% if item.ISBN == page.isbn %}
{% assign book_data = item %}
{% break %}
{% endif %}
{% endfor %}

{% comment %}
한글 필드명을 별도 변수에 할당 (Liquid 호환성)
{% endcomment %}
{% assign book_subtitle = "" %}
{% assign book_intro = "" %}
{% assign book_toc = "" %}
{% assign publisher_review = "" %}
{% assign book_recommend = "" %}
{% assign book_price = "" %}
{% assign book_pages = "" %}
{% assign book_status = "" %}
{% assign book_date = "" %}
{% assign book_imprint = "" %}
{% assign book_width = "" %}
{% assign book_height = "" %}
{% assign book_author = "" %}
{% assign book_translator = "" %}

{% if book_data %}
{% assign book_subtitle = book_data["부제목"] %}
{% assign book_intro = book_data["책 소개"] %}
{% assign book_toc = book_data["목차"] %}
{% assign publisher_review = book_data["출판사 서평"] %}
{% assign book_price = book_data["가격"] %}
{% assign book_pages = book_data["페이지"] %}
{% assign book_status = book_data["상태"] %}
{% assign book_date = book_data["발행일"] %}
{% assign book_imprint = book_data["임프린트"] %}
{% assign book_width = book_data["가로"] %}
{% assign book_height = book_data["세로"] %}
{% assign book_author = book_data["저자"] %}
{% assign book_translator = book_data["번역"] | strip %}
{% assign author_intro = book_data["저자 소개"] %}
{% assign translator_intro = book_data["번역자 소개"] %}
{% endif %}

<article class="book-detail">
    <!-- 책 표지 -->
    <div class="book-detail-cover">
        {% if page.cover_image %}
        <img src="{{ page.cover_image | relative_url }}" alt="{{ page.title }} 표지">
        {% else %}
        <div class="book-cover-placeholder">
            <span>표지 이미지<br>준비중</span>
        </div>
        {% endif %}
    </div>

    <!-- 책 정보 -->
    <div class="book-detail-info">
        <h1 class="book-detail-title">{{ page.title }}</h1>

        <!-- 부제 -->
        {% if book_subtitle != "" %}
        <p class="book-detail-subtitle">{{ book_subtitle }}</p>
        {% endif %}

        <!-- 저자 / 번역 -->
        <p class="book-detail-author">
            {% assign final_author = book_author %}
            {% if final_author == nil or final_author == "" %}
            {% assign final_author = page.author %}
            {% endif %}

            {{ final_author }}

            {% if book_translator and book_translator != "" %}
            {% if final_author and final_author != "" %} | {% endif %}
            {{ book_translator }} 옮김
            {% endif %}
        </p>

        <!-- 메타 정보 -->
        <dl class="book-detail-meta">
            {% if book_imprint != "" %}
            <dt>브랜드</dt>
            <dd>{{ book_imprint }}</dd>
            {% endif %}

            {% if book_date != "" %}
            <dt>출간일</dt>
            <dd>{{ book_date }}</dd>
            {% endif %}

            {% if book_status != "" %}
            <dt>출간상태</dt>
            <dd>{{ book_status }}</dd>
            {% endif %}

            {% if book_price != "" %}
            <dt>정가</dt>
            <dd>{{ book_price }}원</dd>
            {% endif %}

            {% if book_pages != "" %}
            <dt>페이지</dt>
            <dd>{{ book_pages }}쪽</dd>
            {% endif %}

            {% if book_width != "" and book_height != "" %}
            <dt>판형</dt>
            <dd>{{ book_width }} × {{ book_height }}mm</dd>
            {% elsif page.size %}
            <dt>판형</dt>
            <dd>{{ page.size }}</dd>
            {% endif %}

            <dt>ISBN</dt>
            <dd>{{ page.isbn }}</dd>
        </dl>

        <!-- 책 소개 -->
        {% if book_intro.size > 0 %}
        <section class="book-detail-section">
            <h2>책 소개</h2>
            <p>{{ book_intro }}</p>
        </section>
        {% elsif page.description and page.description != "" %}
        <section class="book-detail-section">
            <h2>책 소개</h2>
            <p>{{ page.description }}</p>
        </section>
        {% endif %}

        <!-- 목차 -->
        {% if book_toc.size > 0 %}
        <section class="book-detail-section">
            <h2>목차</h2>
            <div class="book-toc">{{ book_toc }}</div>
        </section>
        {% endif %}

        <!-- 출판사 서평 -->
        {% if publisher_review.size > 0 %}
        <section class="book-detail-section">
            <h2>출판사 서평</h2>
            <div class="book-publisher-review">{{ publisher_review }}</div>
        </section>
        {% endif %}

        <!-- 저자 소개 -->
        {% if author_intro.size > 0 %}
        <section class="book-detail-section">
            <h2>저자 소개</h2>
            <p>{{ author_intro }}</p>
        </section>
        {% endif %}

        <!-- 번역자 소개 -->
        {% if translator_intro.size > 0 %}
        <section class="book-detail-section">
            <h2>번역자 소개</h2>
            <p>{{ translator_intro }}</p>
        </section>
        {% endif %}

        <!-- 서평 (기존 front matter에서) -->
        {% if page.review and page.review != "" %}
        <section class="book-detail-section">
            <h2>서평</h2>
            <blockquote>{{ page.review }}</blockquote>
        </section>
        {% endif %}

        <!-- 뒤로가기 -->
        <a href="{{ '/' | relative_url }}" class="back-link">← 목록으로 돌아가기</a>
    </div>
</article>